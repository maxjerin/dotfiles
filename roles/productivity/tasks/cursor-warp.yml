---
# Install Cursor and Warp terminal on Linux
- name: Install Cursor editor on Linux
  tags:
    - linux
  block:
    - name: Download Cursor editor .deb package
      ansible.builtin.get_url:
        url: https://downloader.cursor.sh/linux/appImage/x64
        dest: /tmp/cursor.AppImage
        mode: '0755'
      when: ansible_pkg_mgr == 'apt'
      register: cursor_download

    - name: Create Cursor application directory
      ansible.builtin.file:
        path: /opt/cursor
        state: directory
        mode: '0755'
      when: ansible_pkg_mgr == 'apt'
      become: true

    - name: Move Cursor AppImage to application directory
      ansible.builtin.copy:
        src: /tmp/cursor.AppImage
        dest: /opt/cursor/cursor.AppImage
        mode: '0755'
        remote_src: yes
      when: ansible_pkg_mgr == 'apt'
      become: true

    - name: Create Cursor desktop entry
      ansible.builtin.copy:
        content: |
          [Desktop Entry]
          Name=Cursor
          Exec=/opt/cursor/cursor.AppImage
          Icon=cursor
          Type=Application
          Categories=Development;IDE;
        dest: /usr/share/applications/cursor.desktop
        mode: '0644'
      when: ansible_pkg_mgr == 'apt'
      become: true

    - name: Clean up Cursor download
      ansible.builtin.file:
        path: /tmp/cursor.AppImage
        state: absent
      when: ansible_pkg_mgr == 'apt'

  when: ansible_os_family == 'Debian'

- name: Install Warp terminal on Linux
  tags:
    - linux
  block:
    - name: Download Warp terminal .deb package
      ansible.builtin.get_url:
        url: https://releases.warp.dev/linux/latest/warp-terminal_amd64.deb
        dest: /tmp/warp-terminal.deb
      when: ansible_pkg_mgr == 'apt'
      register: warp_download

    - name: Install Warp terminal package
      ansible.builtin.apt:
        deb: /tmp/warp-terminal.deb
        state: present
      when: ansible_pkg_mgr == 'apt' and warp_download.changed
      become: true

    - name: Clean up Warp download
      ansible.builtin.file:
        path: /tmp/warp-terminal.deb
        state: absent
      when: ansible_pkg_mgr == 'apt'

  when: ansible_os_family == 'Debian'

